# 合和天下-支付系统开发文档

## 1. 收款-消费者扫码（动态码，不限制额度）

### 1.1 业务流程    

收款方使用该接口生成二维码，付款方使用支付工具（支付宝、微信）扫描该二维码，即可完成支付。

### 1.2 接口详情

#### 请求方法

POST

#### 请求路径

/paysys/v1/csancb

#### 请求 Body

    {
        "data":{
            "unionId":"yourId",
            "clientSn":"200101040005",
            "amount":"2000",
            "payWay":"1",
            "notifyUrl":"yourNotifyUrl"
            },
        "sign":"yourSign"
    }

#### 请求参数说明

| 参数名称  | 类型   | 说明                                               | 举例                               |
| --------- | ------ | -------------------------------------------------- | ---------------------------------- |
| unionId   | string | 唯一身份标识                                       | -                                  |
| clientSn  | string | 订单编号，一个编号的订单，只会被处理一次           | -                                  |
| amount    | string | 收款金额，注意单位是：分                           | 2000 代表 20.00 元。               |
| payWay    | string | 支付渠道                                           | 规定"1"代表支付宝，"2"代表微信支付 |
| notifyUrl | string | 支付结果回调通知地址                               | -                                  |
| sign      | string | 本次请求的签名，后端会严格核验签名。签名算法见文档 | -                                  |

#### 返回数据格式

        {
            "data":{
                "s":"success",
                "m":"成功",
                "d":{
                    "qrCodeString":"https://www.hehetxianxia.com/qrcodeurl"
                }
            },
            "sign":""
        }

#### 返回数据说明

| 参数名称     | 类型   | 说明                                                   | 举例                                |
| ------------ | ------ | ------------------------------------------------------ | ----------------------------------- |
| s            | string | status 的缩写，状态标识                                | success 代表请求成功，fail 代表失败 |
| m            | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因 | -                                   |
| qrCodeString | string | 生成的二维码内容，使用时要将该值转换成二维码图片       | -                                   |


## 2. 收款-商户扫码

### 2.1 业务流程    

解析用户出示的二维码，进行扣款。

### 2.2 接口详情

#### 请求方法

POST

#### 请求路径

/paysys/v1/bscanc

#### 请求 Body

    {
        "data":{
            "unionId":"yourId",
            "clientSn":"200101040005",
            "amount":"2000",
            "payWay":"1",
            "notifyUrl":"yourNotifyUrl"
            },
        "sign":"yourSign"
    }

#### 请求参数说明

| 参数名称  | 类型   | 说明                                               | 举例                               |
| --------- | ------ | -------------------------------------------------- | ---------------------------------- |
| unionId   | string | 唯一身份标识                                       | -                                  |
| clientSn  | string | 订单编号，一个编号的订单，只会被处理一次           | -                                  |
| amount    | string | 收款金额，注意单位是：分                           | 2000 代表 20.00 元。               |
| payWay    | string | 支付渠道                                           | 规定"1"代表支付宝，"2"代表微信支付 |
| notifyUrl | string | 支付结果回调通知地址                               | -                                  |
| sign      | string | 本次请求的签名，后端会严格核验签名。签名算法见文档 | -                                  |

#### 返回数据格式

    {
        "s":"success",
        "m":"成功",
        "d": null 
    }

#### 返回数据说明

| 参数名称     | 类型   | 说明                                                   | 举例                                |
| ------------ | ------ | ------------------------------------------------------ | ----------------------------------- |
| s            | string | status 的缩写，状态标识                                | success 代表请求成功，fail 代表失败 |
| m            | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因 | -                                   |
| qrCodeString | string | 生成的二维码内容，使用时要将该值转换成二维码图片       | -                                   |

## 3. 收款-静态二维码

### 3.1 业务流程    

生成静态聚合支付的二维码。

### 3.2 接口详情

#### 请求方法

POST

#### 请求路径

/paysys/v1/static_qrcode

#### 请求 Body

    {"作业中"}

#### 请求参数说明


#### 返回数据格式


#### 返回数据说明
 

## 4. 清分

### 4.1 业务流程    

开发者使用该接口可将账户中的余额清分到指定子账户（清分到子账户的余额可以使用提现接口，提现到指定银行卡）。

1. n% 作为清分的费用，在清分成功后，会扣除。
2. 清分金额之和不能大于总清分金额的 (100 - n)%。
3. 如果 100 元进行清分，最多能清分 100 * (100 - n)% 元到子账户。
4. 如果 100 元进行清分，实际的清分金额为小于 100 * （100 - n）%，扣除 n% 的费用后，其他的金额会返还。
5. 清分的子账户如果不存在，则会自动创建。

### 4.2 接口详情

#### 请求方法

POST

#### 请求路径

/paysys/v1/share

#### 请求 Body

    {
        "data":{
            "unionId":"yourId",
            "shareSn":"201905050042",
            "shareAmount":"20000",
            "shareTarget":[{
                "phone":"134****9876",
                "shareAmount":"600",
                "message":"邀请人分润",
            },{
                "phone":"13322131456",
                "shareAmount":"12000",
                "message":"商户成本收入",
            },{
                "phone":"13678643421",
                "shareAmount":"12000",
                "message":"代理邀请人分润",
            },
            ],
        },
        "sign":"yourSign"
    }

#### 请求参数说明

| 参数名称    | 类型   | 说明                                               | 举例                               |
| ----------- | ------ | -------------------------------------------------- | ---------------------------------- |
| unionId     | string | 唯一身份标识                                       | -                                  |
| shareSn     | string | 订单编号，同一个编号的清分请求，只会处理第一个     | -                                  |
| shareAmount | string | 用来清分的总金额，单位是：分                       | 2000 代表 20.00 元。               |
| shareTarget | string | 清分的目标用户                                     | -                                  |
| payWay      | string | 支付渠道                                           | 规定"1"代表支付宝，"2"代表微信支付 |
| notifyUrl   | string | 支付结果回调通知地址                               | -                                  |
| sign        | string | 本次请求的签名，后端会严格核验签名。签名算法见文档 | -                                  |

#### 返回数据格式

    {
        "data":{
            "s":"success",
            "m":"成功",
            "d":{
                "result":[
                    {
                        "phone":"134****9876",
                        "balance":"600"
                    },
                    {
                        "phone":"13322131456",
                        "balance":"12000"
                    },
                    {
                        "phone":"13678643421",
                        "balance":"12000"
                    }
                ]
            }
        },
        "sign":""
    }

#### 返回数据说明

| 参数名称 | 类型   | 说明                                                   | 举例                                |
| -------- | ------ | ------------------------------------------------------ | ----------------------------------- |
| s        | string | status 的缩写，状态标识                                | success 代表请求成功，fail 代表失败 |
| m        | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因 | -                                   |
| result   | list   | 返回清分成功后各个子账户的余额                         | -                                   |
| phone    | string | 子账户手机号                                           | -                                   |
| balance  | string | 子账户当前余额                                         | -                                   |

## 5. 提现（对私）

### 5.1 业务流程    

主账户的余额暂时不支持提现，必需使用清分接口将金额分到子账户后，才可以提现。

1. 提现成功后，不能退款，请自行核对银行卡等信息。
2. 款项一般为实时到账，如果遇到银行的结算时间，可能会略有延迟。
3. 提现失败的大部分原因是：卡号、持卡人名称填写错误导致。

### 5.2 接口详情

#### 请求方法

POST

#### 请求路径

/paysys/v1/withdraw

#### 请求 Body

    {
        "data":{
            "unionId":"yourId",
            "clientSn":"200101040005",
            "notifyUrl":"yourNotifyUrl",
            "withDraw":[
                {
                    "phone":"13145678901",
                    "bankCode":"1000767281",
                    "accountNo":"***********",
                    "payeeName":"持有人",
                    "amount":"1300"
                },
                {
                    "phone":"13145678901",
                    "bankCode":"1000767281",
                    "accountNo":"***********",
                    "payeeName":"持有人2",
                    "amount":"700"
                }
            ]
        },
        "sign":"yourSign"
    }

#### 请求参数说明

| 参数名称  | 类型   | 说明                                               | 举例 |
| --------- | ------ | -------------------------------------------------- | ---- |
| unionId   | string | 唯一身份标识                                       | -    |
| clientSn  | string | 订单编号，一个编号的订单，只会被处理一次           | -    |
| notifyUrl | string | 结果回调通知地址                                   | -    |
| phone     | string | 子账号的手机号，请确保子账户的余额不小于提现金额   | -    |
| bankCode  | string | 银行码，请参考“银行码对照表”                       | -    |
| accountNo | string | 银行卡号                                           | -    |
| payeeName | string | 持卡人姓名                                         | -    |
| amount    | string | 提现的金额，注意单位是“分”                         | -    |
| sign      | string | 本次请求的签名，后端会严格核验签名。签名算法见文档 | -    |

#### 返回数据格式

    {
        "data":{
            "s":"success",
            "m":"成功",
            "d":{
                "result":[
                    {
                        "phone":"134****9876",
                        "balance":"600"
                    },
                    {
                        "phone":"13322131456",
                        "balance":"12000"
                    },
                    {
                        "phone":"13678643421",
                        "balance":"12000"
                    }
                ]
            }
        },
        "sign":""
    }

#### 返回数据说明

| 参数名称 | 类型   | 说明                                                                   | 举例                                           |
| -------- | ------ | ---------------------------------------------------------------------- | ---------------------------------------------- |
| s        | string | status 的缩写，状态标识                                                | success 只是代表请求的成功，不代表提现到账成功 |
| m        | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因                 | -                                              |
| data   | list   | 返回提现成功后各个子账户的余额。如果确认提现失败，余额会退回当相应账户 | -                                              |
| phone    | string | 子账户手机号                                                           | -                                              |
| balance  | string | 子账户当前余额                                                         | -                                              |


## 6. 提现（对公）

### 6.1 业务流程    

主账户的余额暂时不支持提现，必需使用清分接口将金额分到子账户后，才可以提现。

1. 提现成功后，不能退款，请自行核对银行卡等信息。
2. 款项一般为实时到账，如果遇到银行的结算时间，可能会略有延迟。
3. 提现失败的大部分原因是：卡号、持卡人名称填写错误导致。

### 6.2 接口详情

#### 请求方法

POST

#### 请求路径

/paysys/v1/withdraw

#### 请求 Body

    {
        "data":{
            "unionId":"yourId",
            "clientSn":"200101040005",
            "notifyUrl":"yourNotifyUrl",
            "withDraw":[
                {
                    "phone":"13145678901",
                    "bankCode":"1000767281",
                    "accountNo":"***********",
                    "payeeName":"持有人",
                    "amount":"1300"
                },
                {
                    "phone":"13145678901",
                    "bankCode":"1000767281",
                    "accountNo":"***********",
                    "payeeName":"持有人2",
                    "amount":"700"
                }
            ]
        },
        "sign":"yourSign"
    }

#### 请求参数说明

| 参数名称  | 类型   | 说明                                               | 举例 |
| --------- | ------ | -------------------------------------------------- | ---- |
| unionId   | string | 唯一身份标识                                       | -    |
| clientSn  | string | 订单编号，一个编号的订单，只会被处理一次           | -    |
| notifyUrl | string | 支付结果回调通知地址                               | -    |
| phone     | string | 子账号的手机号，请确保子账户的余额不小于提现金额   | -    |
| bankCode  | string | 银行码，请参考“银行码对照表”                       | -    |
| accountNo | string | 银行卡号                                           | -    |
| payeeName | string | 持卡人姓名                                         | -    |
| amount    | string | 提现的金额，注意单位是“分”                         | -    |
| sign      | string | 本次请求的签名，后端会严格核验签名。签名算法见文档 | -    |

#### 返回数据格式

    {
        "data":{
            "s":"success",
            "m":"成功",
            "d":{
                "result":[
                    {
                        "phone":"134****9876",
                        "balance":"600"
                    },
                    {
                        "phone":"13322131456",
                        "balance":"12000"
                    },
                    {
                        "phone":"13678643421",
                        "balance":"12000"
                    }
                ]
            }
        },
        "sign":""
    }

#### 返回数据说明

| 参数名称 | 类型   | 说明                                                                                        | 举例                                           |
| -------- | ------ | ------------------------------------------------------------------------------------------- | ---------------------------------------------- |
| s        | string | status 的缩写，状态标识，即使返回成功代表银行已经接受这笔转账，如果转账失败，款项会原路退回 | success 只是代表请求的成功，不代表提现到账成功 |
| m        | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因                                      | -                                              |
| result   | list   | 返回提现成功后各个子账户的余额。如果确认提现失败，余额会退回当相应账户                      | -                                              |
| phone    | string | 子账户手机号                                                                                | -                                              |
| balance  | string | 子账户当前余额                                                                              | -                                              |
