# 合和天下-账户系统开发文档

## 1. 主账户信息

### 1.1 业务流程    

查询主账户的收款、清分、清分费用、余额等情况。

1. 余额可以用于清分。
2. 未清分的金额 + 清分的费用 + 已清分金额= 总计的收款金额

### 1.2 接口详情

#### 请求方法

GET

#### 请求路径

/api/account/v1/balance

#### 返回数据格式

    {
        "s": "success",
        "m": "成功",
        "d": {
            "id": 1,
            "main_account_uid": 123456,
            "total_in_amount": 0,
            "total_in_fee": 0,
            "in_fee_rate": 0,
            "total_share_amount": 0,
            "total_share_fee": 0,
            "share_fee_rate": 0,
            "balance": 0,
            "total_withdraw_amount": 0,
            "total_withdraw_fee": 0,
            "withdraw_fee_rate": 0
        }
    }

#### 返回数据说明

| 参数名称 | 类型   | 说明                                                   | 举例                               |
| -------- | ------ | ------------------------------------------------------ | ---------------------------------- |
| s        | string | status 的缩写，状态标识                                | success                            |
| m        | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因 | -                                  |
| total    | string | 总计的收款金额                                         | total = share + shareFee + balance |
| share    | string | 已清分的金额                                           | -                                  |
| shareFee | string | 清分的费用                                             | -                                  |
| balance  | string | 未清分的金额                                           | -                                  |

## 2. 收款明细

### 2.1 业务流程    

查询所有收款渠道的明细。

### 2.2 接口详情

#### 请求方法

GET

#### 请求路径

/api/account/v1/in_detail

#### 请求 query params

| 参数名称    | 说明                                                                           | 是否必须 | 举例                                             |
| ----------- | ------------------------------------------------------------------------------ | ---- | ------------------------------------------------ |
| startTime| 要查询账单的开始时间戳，单位秒                                                 | 非必须，默认全查|-                                                |
| endTime  | 要查询账单的开始时间戳，单位秒                                                 | 非必须，默认全查 |-                                                |
| status   | 要查询的账单的状态，                                                           |非必须，默认全查 |ALL 代表全部，1 代表已支付，0 代表付款失败，-1 代表等待支付结果中 |
| page | 页码 | 非必须，默认分页为每页 100，默认查找第一页 | 1 |

#### 返回数据格式

    {
        "s": "success",
        "m": "成功",
        "d": {
            "result": [
                {
                    "id": 2,
                    "main_account_uid": "123456",
                    "client_sn": "11",
                    "sn": "",
                    "amount": 2300,
                    "msg": "支付宝",
                    "pay_way": "支付宝",
                    "status": 0,
                    "gen_time": "2019-05-18T16:17:00",
                    "pay_time": "2019-05-18T16:17:00"
                },
                {
                    "id": 1,
                    "main_account_uid": "123456",
                    "client_sn": "201805090001",
                    "sn": "",
                    "amount": 100,
                    "msg": "支付宝",
                    "pay_way": "支付宝",
                    "status": 1,
                    "gen_time": "2019-05-18T16:07:00",
                    "pay_time": "2019-05-18T16:07:00"
                }
            ]
        }
    }

#### 返回数据说明

| 参数名称 | 类型   | 说明                                                   | 举例                                           |
| -------- | ------ | ------------------------------------------------------ | ---------------------------------------------- |
| s        | string | status 的缩写，状态标识                                | success 只是代表请求的成功，不代表提现到账成功 |
| m        | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因 | -                                              |

## 3. 已清分的明细

### 3.1 业务流程    

查询指定时间已清分的账单

### 1.2 接口详情

#### 请求方法

GET

#### 请求路径

/api/account/v1/shared_detail

#### 请求 query params

| 参数名称    | 说明    | 是否必须 | 举例                                             |
| ----------- | ------| ---- | ------------------------------------------------ |
| page | 页码 | 非必须，默认分页为每页 100，默认查找第一页 | 1 |

#### 返回数据格式

    {
        "s": "success",
        "m": "成功",
        "d": {
            "result": [
                {
                    "client_sn": "201805090001",
                    "child_phone": "13804542921",
                    "changed_amount": 1,
                    "changed_type": 2,
                    "msg": "清分",
                    "gen_time": "2019-05-21T18:36:00",
                    "complete_time": "2019-05-21T18:36:00"
                }
            ]
        }
    }

#### 返回数据说明

| 参数名称 | 类型   | 说明                                                   | 举例                               |
| -------- | ------ | ------------------------------------------------------ | ---------------------------------- |
| s        | string | status 的缩写，状态标识                                | success                            |
| m        | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因 | -                                  |

## 4. 已提现的明细

### 4.1 业务流程    

查询指定时间，主账户下所有已提现的明细。

### 4.2 接口详情

#### 请求方法

GET

#### 请求路径

/api/account/v1/withdraw_detail

#### 请求 query params

| 参数名称    | 说明                                                                           | 是否必须 | 举例                                             |
| ----------- | ------------------------------------------------------------------------------ | ---- | ------------------------------------------------ |
| page | 页码 | 非必须，默认分页为每页 100，默认查找第一页 | 1 |

#### 返回数据格式

    {
        "s": "success",
        "m": "成功",
        "d": {
            "result": [
                {
                    "client_sn": "201805090002",
                    "child_phone": "13804542921",
                    "changed_amount": 1,
                    "changed_type": -1,
                    "msg": "提现",
                    "gen_time": "2019-05-21T18:36:00",
                    "complete_time": "2019-05-21T18:36:00",
                    "status": 1
                }
            ]
        }
    }

#### 返回数据说明

| 参数名称 | 类型   | 说明                                                   | 举例                               |
| -------- | ------ | ------------------------------------------------------ | ---------------------------------- |
| s        | string | status 的缩写，状态标识                                | success                            |
| m        | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因 | -                                  |

## 5. 子账户概览（可指定子账户）

### 5.1 业务流程    

查询主账户下所有的子账户的明细，可以获得子账户的名称、余额等信息。

### 5.2 接口详情

#### 请求方法

GET

#### 请求路径

/api/account/v1/children_detail

#### 请求 query param

| 参数名称    | 说明   | 是否必须 | 举例   |
| ----------- | -------- | ---- | -------------- |
| phone | 要查找的子账户 | 非必须，如果不传，默认查询所有 | - |
| page | 页码 | 非必须，默认分页为每页 100，默认查找第一页 | 1 |

#### 返回数据格式

    {
        "data":{
            "s":"success",
            "m":"成功",
            "d":{
                "result":[
                    {
                        "phone":"138****9987",
                        "amount":"2900",
                        "time":"2019-02-06 9:00"
                    },{
                        "phone":"138****9987",
                        "amount":"2900",
                        "time":"2019-02-06 9:00"
                    }
                ]
            }
        },
        "sign":""
    }

#### 返回数据说明

| 参数名称 | 类型   | 说明                                                   | 举例                               |
| -------- | ------ | ------------------------------------------------------ | ---------------------------------- |
| s        | string | status 的缩写，状态标识                                | success                            |
| m        | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因 | -                                  |

## 6. 查询子账户余额变动详情

### 6.1 业务流程    

传入子账户手机号，查询子账户余额的变动详情。支持自定义时间段。

### 6.2 接口详情

#### 请求方法

GET

#### 请求路径

/api/account/v1/child_detail

#### 请求 Body

    {
        "data":{
            "unionId":"yourId",
            "timeStamp":"34422112333",
            "phone":"13245678332",
            "startTime":"12345513421",
            "endTime":"68194649114",
        },
        "sign":"yourSign"
    }

#### 请求参数说明

>  非必须参数，
> 
> - 可以传空字符串
> 
> - 可以传 null
> 
> - 可以将该字段省略

| 参数名称  | 类型   | 说明                                                                           | 举例 |
| --------- | ------ | ------------------------------------------------------------------------------ | ---- |
| unionId   | string | 唯一身份标识                                                                   | -    |
| timeStamp | string | 以秒为单位的当前时间戳，如果时间戳和服务器时间相差超过 10 秒，将会拒绝本次请求 | -    |
| phone | string | 指定子账户手机号。| -    |
| startTime | string | 要查询账单的开始时间戳，单位秒                                                 | -    |
| endTime   | string | 要查询账单的开始时间戳，单位秒                                                 | -    |
| sign      | string | 本次请求的签名，后端会严格核验签名。签名算法见文档                             | -    |

#### 返回数据格式

    {
        "data":{
            "s":"success",
            "m":"成功",
            "d":{
                "balance":"0",
                "last_modified_time":"2019-02-06 9:00",
                "result":[
                    {
                        "phone":"13245678332",
                        "changed_amount":"2900",
                        "current_amount":"2900",
                        "message":"代理分润收入",
                        "time":"2019-02-06 9:00"
                    },{
                        "phone":"13245678332",
                        "changed_amount":"100",
                        "current_amount":"3000",
                        "message":"分润收入",
                        "time":"2019-02-06 9:00"
                    },{
                        "phone":"13245678332",
                        "changed_amount":"2900",
                        "current_amount":"100",
                        "message":"提现",
                        "time":"2019-02-06 9:00"
                    },{
                        "phone":"13245678332",
                        "changed_amount":"100",
                        "current_amount":"0",
                        "message":"提现",
                        "time":"2019-02-06 9:00"
                    }
                ]
            }
        },
        "sign":""
    }

#### 返回数据说明

| 参数名称 | 类型   | 说明                                                   | 举例                               |
| -------- | ------ | ------------------------------------------------------ | ---------------------------------- |
| s        | string | status 的缩写，状态标识                                | success                            |
| m        | string | message的缩写，当 s 的值为 fail 的时候，会提示失败原因 | -                                  |